# Collection of Maven plugins for GlobalId event driven architecture

This repository contains two maven plugins used for generation of asyncapi definitions and corresponding models for
GiD Quarkus services using event driven architecture. 

# Instructions

```
mvn clean verify
```
If you want to make the plugins available in your local `.m2/repository` run `mvn clean install`


# Asyncapi generator plugin

The asyncapi generator plugin scans the project for methods in classes annotated with annotations defined in the `smallrye-eda`
project. It scans the annotation parameters with the method signatures and generates a AsyncAPI schema definition for the project.
That schema definition can then further be used for generation of models, consumers, producers, etc.

##Usage and configuration
Basic pom.xml plugin section:
```xml
<plugin>
    <artifactId>asyncapi-schema-generator-maven-plugin</artifactId>
    <version>1.0.0-SNAPSHOT</version>
    <groupId>id.global.events</groupId>
    <executions>
        <execution>
            <goals>
                <goal>generate-schema</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```
This will generate asyncapi schema files in the `target/generated/` folder. 

It's recommended to use the latest non-snapshot version of this plugin

###Uploading to Apicurio registry
To enable uploading your generated schemas to an Apicurio registry add the following section to your plugin configuration:
```xml
<configuration>
    <apicurioRegistryUrl>https://{url-to-apicurio-server}/</apicurioRegistryUrl>
    <uploadType>yaml</uploadType>
</configuration>
```

`uploadType` can be either `yaml` or `json`. Default is `json`.


###Additional configuration
####ScanPackages
List packages to scan for annotations. If ommitted all packages will be scanned, unless overridden by other config properties.

Example:
```xml
<configuration>
    <scanPackages>
        id.global.myhandler.package
    </scanPackages>
</configuration>
```

####ScanClasses
List classes to scan for annotations. If omitted all classes will be scanned, unless overridden by other config properties.

Example:
```xml
<configuration>
    <scanClasses>
        MyEventHandler
    </scanClasses>
</configuration>
```
####ScanExcludePackages
List of packages to exclude from annotation scanning. If for example you want to exclude a message handler from being scanned
list it in the `scanExcludeClasses` configuration property.

Example:
```xml
<configuration>
    <scanExcludePackages>
        id.global.myhandler.package
    </scanExcludePackages>
</configuration>
```

####ScanExcludeClasses
List of classes to exclude from annotation scanning. If for example you want to exclude a message handler from being scanned
list it in the `scanExcludeClasses` configuration property.

Example:
```xml
<configuration>
    <scanExcludeClasses>
        MyEventHandler
    </scanExcludeClasses>
</configuration>
```
This will exclude MyEventHandler.class from being scanned for annotations.

####ExcludeFromSchemas

Example of plugin configuration:
```xml
<configuration>
    <excludeFromSchemas>
        <excludeFromSchema>java.util</excludeFromSchema>
        <excludeFromSchema>org.your.package.prefix</excludeFromSchema>
    </excludeFromSchemas>
</configuration>
```

Listing a package or a package prefix in the `excludeFromSchemas` will force the schema generator to handle everything matching 
that package as a `object`. One example could be a `Map<K,V>` property in a event class. If the `java.util` package is not present 
in the `excludeFromSchemas` it will show up in the `components/schemas` part of the AsyncApi definition.

Example of the Map included in the definition
```yaml
components:
  schemas:
    ....
    Map(String,Object):
      type: object
    ....
    EventWithMap:
      type: object
      properties:
        someMap:
          $ref: "#/components/schemas/Map(String,Object)"
        anotherProperty:
          type: string
    ....
```

Example of the Map excluded from the definition
```yaml
components:
  schemas:
    ....
    EventWithMap:
      properties:
        someMap:
          type: object
        anotherProperty:
          type: string
    ....
```

####ScanDependenciesDisable
Setting this to `true` will disable scanning all external dependencies. In some cases external dependencies contain some encoded
strings which will throw some kind of exception during scanning of the jar, which we want to avoid. If you still want to scan 
some dependency jars you can include them in the `scanDependenciesJars` property.

Example:
```xml
<configuration>
    <scanDependenciesDisable>true</scanDependenciesDisable>
</configuration>
```


# Amqp generator plugin
The AMQP generator plugin uses the AsyncAPI schema, generated by the `AsyncApi generator plugin` and generates a library consisting
of models, producer classes and whatnot to be used by services wanting to communicate with our service.

##Usage and configuration

```xml
<plugin>
    <groupId>id.global</groupId>
    <artifactId>amqp-generator-maven-plugin</artifactId>
    <version>1.1-SNAPSHOT</version>
    <executions>
        <execution>
            <phase>package</phase>
            <goals>
                <goal>generate-amqp-models</goal>
            </goals>
        </execution>
    </executions>
    <configuration>
        <artifactSource>FILE</artifactSource>
        <packageName>id.global.models.${artifactId}</packageName>
        <fileDestination>asyncapi.json</fileDestination>
        <modelName>${artifactId}</modelName>
        <modelVersion>${version}</modelVersion>
    </configuration>
</plugin>
```